sudo: required
language: node_js
node_js:
- '7'
os:
- linux
- osx
dist: xenial
cache:
  directories:
  - node_modules
  - "$HOME/.cache/electron"
  - "$HOME/.cache/electron-builder"
before_cache:
- rm -rf $HOME/.cache/electron-builder/wine
install:
- git config --global user.name "kanna12"
- git config --global user.email "kgoku98@gmail.com"
- npm install
- npm install -g electron electron-packager electron-builder
- export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
- git tag $TRAVIS_TAG
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo dpkg --add-architecture i386; wget
  -qO - https://dl.winehq.org/wine-builds/winehq.key | sudo apt-key add -; sudo apt-add-repository
  'deb https://dl.winehq.org/wine-builds/ubuntu/ xenial main'; sudo apt-get update;
  sudo apt-get install --install-recommends winehq-stable; wine --version; fi
script:
- npm run dist
- pwd
- mkdir builds
- fname=$(date +%y%m%d); mkdir builds/$fname;
- ls -ltr .
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pwd ; ls -ltr .; zip -r mac-archive.zip
  ./dist; mv mac-archive.zip builds/$fname; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then zip -r archive.zip ./dist; mv archive.zip
  builds/$fname; rm -rf dist; npm run pack-win ; pwd ; ls -ltr .; zip -r win-archive.zip
  ./dist; mv win-archive.zip builds/$fname; fi
deploy:
  provider: s3
  access_key_id: AKIAQ5N4EWDLFPQXWFEW
  secret_access_key:
    secure: Y30qVA3mms2OnFY2y4FuLgRZtA63Rtp9vnCXrK1FeYPhT2ZbTGFugrdRieI6eubpYonE+E62Yn7RL4mE+qRwwwlS//C6mkc2BGkgA320S6CdCqFnheqsaLsQV+VFe6LIcSv8SlwlWiMpe5lyNZAFkJWRBi+FaTLm/1LFpzYqjLgcJ/ik1YbnJyoSPlL5mMSuDJZ8ESCVZx3z1XSF6DFPKbDrBAMtbr/z+jHRhiJYAs6gM+7Ys49xC8V1Kz4qMT9tlRlzJzyQ0XwE6AoixXD0C8+6xNhNuVn6Lj6mvRWK6vB/snjGH8iY/FSzhvu2SRtxOooRd1JazyGi/N6UICwkO3sBdcI6lz4mfb6EPRF8xlQhvAxPbtw2I0tKHu82QgjFljRtN0Mc/4yXxPLcF6FgmVd93HI3+esUHt+R6HN9F0uH10ZmgI45EH+y3nRRq4qjQ5JzrvZ8qRrVRieIqI8yYUu4psEbl/tDDUjSaUUO1tKCrjTuhyWfU4tg+kHah3ASaeqvPbzqG1vvjE/8iNeSsm68b8HsIt3buQ8ZJQhRAuSz2pE6bu/aPw2KCHNvYqwGC7NXP2N0PmBgHjJbN6KWtQD6CDtqT6LGizeOMRAktcnMH5VwGvUS1b/o4S5ym2pygbx7P8Tz6A+A6z889RTYPcWLBxT6Mp3dxrey3stOxEw=
  bucket: electron-deployment
  local-dir: builds
  skip_cleanup: true
  on:
    repo: Kanna12/Mac-win-lix
